Include "tabellInsammlare.def"


Type ReningsObjekt

	Fastighet_rening as string
	Antal_hushåll_rening as integer
	Reningstyp as string
	Storlek_m2 as float
	Beslut_datum as date
	Utförd_datum as date
	Kommentarer as string
	spatialFastighet as string
	spatialShift as string
	rowIndex as integer
	kordinater as string
	Anslutna_fastigheter() as string

end Type

Type SwerefObjekt

	FASTIGHET as string
	Fastighet_tillstånd as string
	Ärendenr as string
	Beslut_datum as date
	Status as string
	Utskick1_datum as date
	Anteckning as string
	utförddatum as date
	slamhämtning as string
	Antal_byggnader as integer	
	kordinater as string
	SpatialFastighet as string

end Type

Type EnskiltObjekt

	Diarienummer as string
	Fastighet_tillstånd as string
	Typ_byggnad as string
	Antal_hushåll_tillstånd as string
	Fastighet_rening as string
	Typ_Slamavskiljare as string
	Storlek_m3 as float
	Typ_rening as string
	Storlek_m2 as float
	Typ_sluten_tank as string
	Storlek__m3 as float
	Beslut_datum as date
	Utförd_datum as date
	Avgift as integer
	Tillstånd_giltigt_tom as date
	Anteckningar as string
	spatialShift as string
	spatialFastighet as string
	kordinater as string
	
end Type

Type UtskriftsObjekt
	
	trovärdighetsIndex as float

	Besöksadress_Adress as String
	Besöksadress_Postnr as String
	Besöksadress_Ort as String
	Besöksadress_Huvudfastighet as String
	FNR as integer
	 
	Verksamhetsutövare_Namn as String
	Verksamhetsutöv_Person_orgnr as integer
 
	Fakturamottagare_NAMN as String
	Fakturamottagare_Faktura_ADRESS as String
	Fakturamottagare_Faktura_POSTNR as String
	Fakturamottagare_Faktura_POSTOR as String
 
	Enhet as String
	Anteckning as String
	Aktuell_timavgift as integer
	Timdebitering as Logical
	Objektnamn as String

	flik_Avloppsänlaggni_Boendetyp as String
	flik_Avloppsanläggn_Byggnadsår as date
	flik_Avloppsa_Besiktningsdatum as date
	flik_Avloppsanläg_Beslutsdatum as date
	Vatten as String
  
	Recipient as String

	Inventering as String
	Inventeringsinformation_Datum as date
	Inventeringsinformation_Status as String
	Bedömning as String
  
	fliken_Fastigheter as String
	fliken_Fastigheter_FNR as integer

	PunkttypAB as String
	Fliken_Koordinater as String

	fliken_Ärenden as String

	Anläggningskategori as String
	besiktningdatum as date
	beslutsdatum as date
	Anläggningstyp as String
	Volym_m3 as float
	Anl_för_EftR_TöInterv_mån as integer
	AnlF_efR_Koordinater_X_o_Y as String
	PunkttypER as String
	Anläggning_för_EfterföljRText as String

	Anläggningskategori_2 as String
	Anläggning_för_S_Anläggningstyp as String
	Externt_Tjänsteid as String
	text as String
	Anläggning_för_Slamav_Volym_m3 as float
	
	Anläggningskategori_3 as String
	AnlförEfterR_Anläggningstyp as String
	besiktningdatum_2 as date
	beslutsdatum_2 as date
	Externt_Tjänsteid_2 as String
	Volym_m3_2 as float

	Objektid as integer
	Path as String
	Diarienummer as String
	Löpnummer as integer


	sql as string
	reningsindex as integer
	
end Type

Type FastighetsObjekt
	
	fastighet as string
	fnr as integer
	
	swerefobjekt() as SwerefObjekt
	reningsobjekt() as reningsObjekt
	enskiltobjekt() as enskiltObjekt
	
	adress as string
	postnr as string
	ort as string
	kir as string
			
	namn as string
	personnr as integer

	adressNamn as string
	PostNrNamn as string
	PostortNamn as string
	
End Type

Type TrovärdighetsObjekt
	index as float
	ex as integer
	fx as integer
	rx as integer
End Type
'även ifall man "pregenerating area" tar hela processen fortfarande väldigt lång tid, frågan är om skulle kunna förindexera alla fastigheter
'ty varjer within+within+within tar längretid än en tre gånger så stor within.
'ääääääääääääääääääääääääääääääääääääääääääääääääääääääääääääääääääääääääääääääääääääääää
'när en matchning gjorts, ta bort delarna från ittarationen
'gör ny matchning på resterande.
'önskade mutationer är ihopparade ressultat, samt de ej assosicerade bitarna för sig
'önskade mutationer är ihopparade ressultat, samt de ej assosicerade bitarna för sig
' tex om en enskilt som inte har en rening att matcha denne
' tex en sweref som inte har en enskilt att matcha med
' dock inga reningar då dessa får tas fram senare.
'	print FastighetsObjekt.fastighet & ":" & ubound(FastighetsObjekt.enskiltobjekt()) & ":" & ubound(FastighetsObjekt.swerefobjekt()) & ":" & ubound(FastighetsObjekt.reningsobjekt())
'
'	if(ubound(fastighetsobjekt.swerefobjekt)>ubound(fastighetsobjekt.enskiltobjekt)) then
'		'make regular mutations
'		'for each beslut pick most accurat
'		'if the is one that's not
'		'make a mutation where only sweref left
'		'the mutation with the swerefobjekt who have the highest match get picked
'	end if
'	
'	if(ubound(fastighetsobjekt.reningsobjekt)>ubound(fastighetsobjekt.enskiltobjekt)) then
'		'the mutation with the rening who have the highest match get picked
'	end if
Include "MapBasic.def"
include "Menu.def"


	' hur vet vi att en gemensam rening redan refferats till?
	' skapar att objekt enligt rutin för gemensamhetanläggningar, samt att vi lägger till det radindex
	' när vi sedan är påväg att skapa ett gemensamhetsobjekt i ressultattabellen, skippar vi att skapaom rOet
	' om index redan finns där.
	
declare sub createRessultTableX(byval tablename as string, byval filePath as string)
declare sub genereraSQLVärdeArray(värde() as string, utskriftsobjekt as utskriftsobjekt)
declare sub generateTokenObjekts(reningsTokenObjekt() as reningsobjekt, enskiltTokenObjekt() as enskiltObjekt, swerefTokenObjekt() as swerefobjekt)
declare sub FastighetsObjCreation(fastighetsBetInput as string,reningsobjekt() as reningsobjekt,fastighetsObjekt() as fastighetsObjekt,swerefObjekt() as swerefObjekt,enskiltObjekt() as enskiltObjekt)
declare sub fastighetForUtskriftsobjekt(utskriftsObjekt() as utskriftsobjekt,itterator as integer,fastighetsobjekt as fastighetsobjekt,swerefObjekt as swerefobjekt,reningsobjekt as reningsobjekt,enskiltObjekt as enskiltobjekt, objektid as integer)
declare sub insertInitialTables()
declare Sub gemAnslutna(caseString as string,ressultArray() as string)
declare sub PrepareGemensamma()
declare sub utskrivningsobjektsKonstruktor(
		swerefobjekt as swerefobjekt,
		reningsobjekt as reningsobjekt,
	'är det för krävande att hämta poster enligt index?
	'FastighetsBetInput = columnAtIndexAsString(temp,tempString,iprogress)

	'gissar vilket distrikt som fastighet hör till som skall öppnas
	'nödvändigt för att spara tid?'''ja det är nödvändigt, fundera på att skära ner i ännu mindre delar.
	'bit nedskärning gjorde väldigt liten tidskillnad gemnförelse att förindexera alla sökvariabler.
			'när högst trovärdighet valts ut, skapas ett utskriftsobjekt			
			'			print ubound(FastighetsObjekt.swerefobjekt) & "fx" '& trovärdighetsobjekt(mestTrov).fx
			'			print ubound(FastighetsObjekt.reningsobjekt) & "rx" '& trovärdighetsobjekt(mestTrov).rx
			'			print ubound(FastighetsObjekt.enskiltobjekt) & "ex" '& trovärdighetsobjekt(mestTrov).ex
			'			print ubound(trovärdighetsobjekt) & "tro " & mestTrov & " tra"
		enskiltobjekt as enskiltobjekt,
		UtskriftsObjekt() as UtskriftsObjekt,
		användaReningar() as integer,
		trovärdighetsIndex as float,
		fastighetsObjekt as fastighetsObjekt
	)
